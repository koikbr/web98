/**
 * Pixel Emoji Pack mappings - maps Unicode emojis to pixel emoji files
 *
 */

export const unicodeToPixelEmoji = {
  // Basic emotions
  "ðŸ™‚": "Emotes/Smile.png",
  "ðŸ˜Š": "Emotes/Happy.png",  // ðŸ˜Š vs ðŸ™‚
  "ðŸ˜„": "Emotes/Laugh.png",
  "ðŸ˜": "Emotes/Laugh.png", 
  "ðŸ˜‚": "Emotes/Laugh.png",
  "ðŸ˜ƒ": "Emotes/Happy.png",
  "ðŸ˜€": "Emotes/Smile.png",
  "ðŸ˜Ž": "Emotes/Cool.png",
  "ðŸ¤”": "Emotes/Thinking.png",  // thinking face
  "ðŸ˜”": "Emotes/Sad.png",
  "ðŸ˜•": "Emotes/Confused.png",   // confused face
  "ðŸ˜’": "Emotes/Eye Roll.png",  // unamused face
  "ðŸ˜": "Emotes/Smirk.png",     // smirking face
  
  // More emotions
  "ðŸ’˜": "Emotes/In Love.png",
  "ðŸ˜": "Emotes/In Love.png",  // heart eyes vs ðŸ’˜
  "ðŸ˜˜": "Emotes/Kiss.png",
  "ðŸ˜š": "Emotes/Kiss.png",
  "ðŸ˜™": "Emotes/Kiss.png",
  "ðŸ˜‹": "Emotes/Eating.png",    // yum face
  "ðŸ˜›": "Emotes/Silly.png",     // playfully sticking out tongue
  "ðŸ˜œ": "Emotes/Silly.png",     // winking and sticking out tongue
  "ðŸ˜": "Emotes/Silly.png",     // tightly-closed-eyes face
  "ðŸ˜ž": "Emotes/Frown.png",
  "ðŸ˜Ÿ": "Emotes/Worried.png",
  "ðŸ˜ ": "Emotes/Mad.png",
  "ðŸ˜¡": "Emotes/Furious.png",
  "ðŸ˜¢": "Emotes/Crying.png",   // crying face
  "ðŸ˜£": "Emotes/Pain.png",      // persevering face
  "ðŸ˜¤": "Emotes/Rage.png",
  "ðŸ˜¥": "Emotes/Sad.png",      // sad but relieved face
  "ðŸ˜¦": "Emotes/Concerned.png", // frowning face with open mouth
  "ðŸ˜§": "Emotes/Frightened.png", // anguished face
  "ðŸ˜¨": "Emotes/Scared.png",    // fearful face
  "ðŸ˜©": "Emotes/Tired.png",    // weary face
  "ðŸ˜ª": "Emotes/Sleep.png",    // sleeping face
  "ðŸ˜«": "Emotes/Tired.png",    // tired face
  "ðŸ˜¬": "Emotes/Concerned.png", // grimacing face
  "ðŸ˜­": "Emotes/Crying.png",    // loudly crying face
  "ðŸ˜®": "Emotes/Oh.png",        // open mouth
  "ðŸ˜¯": "Emotes/Surprised.png", // hushed face
  "ðŸ˜°": "Emotes/Sweating.png", // anxious face with sweat
  "ðŸ˜±": "Emotes/Frightened.png", // face screaming in fear
  "ðŸ˜²": "Emotes/Stunned.png",   // astonished face
  "ðŸ˜³": "Emotes/Blush.png",    // flushed face
  "ðŸ˜´": "Emotes/Sleep.png",
  "ðŸ˜µ": "Emotes/Mind Blown.png", // dizzy face
  "ðŸ˜¶": "Emotes/Speechless.png", // face without mouth
  "ðŸ˜·": "Emotes/Gas Mask.png",  // medical mask
  "ðŸ˜¸": "Emotes/Happy.png",     // grinning cat face
  "ðŸ˜¹": "Emotes/Laugh.png",     // cat face with tears of joy
  "ðŸ˜º": "Emotes/Smile.png",     // smiling cat
  "ðŸ˜»": "Emotes/In Love.png",   // heart eyes cat
  "ðŸ« ": "Emotes/Hot.png",
  "ðŸ«¥": "Emotes/Blank Face.png",
  "ðŸ«¡": "Emotes/Virtous.png",
  "ðŸ«¤": "Emotes/Hmmm.png",
  "ðŸ¥¹": "Emotes/Worried.png",
  "ðŸ«£": "Emotes/Scared.png",
  "ðŸ¥²": "Emotes/Smile.png",
  // Hearts and symbols
  "ðŸ’“": "Misc/Heart.png",
  "ðŸ’”": "Misc/Heart.png",      // broken heart - still same base sprite
  "ðŸ’–": "Misc/Heart.png",      // sparkling heart - same base sprite
  "ðŸ’—": "Misc/Heart.png",      // glowing heart - same base sprite
  "ðŸ’™": "Misc/Heart.png",      // blue heart - same base sprite
  "ðŸ’š": "Misc/Heart.png",      // green heart - same base sprite
  "ðŸ’›": "Misc/Heart.png",      // yellow heart - same base sprite
  "ðŸ’œ": "Misc/Heart.png",      // purple heart - same base sprite
  "ðŸ¤": "Misc/Heart.png",      // white heart - same base sprite
  "ðŸ¤Ž": "Misc/Heart.png",      // brown heart - same base sprite
  "ðŸ–¤": "Misc/Heart.png",      // black heart - same base sprite
  "â¤ï¸": "Misc/Heart.png",      // red heart same base sprite
  
  // Fire and hot
  "ðŸ”¥": "Emotes/On Fire.png",
  
  // Weather
  "ðŸŒ§ï¸": "Misc/Water.png",      // rain
  "â˜”": "Misc/Water.png",      // umbrella with rain drops
  "â›ˆï¸": "Misc/Water.png",      // thunderstorm
  "ðŸ’§": "Misc/Water.png",      // droplet
  
  // Zodiac signs and symbols
  "â™ˆ": "Misc/Fire.png",       // Aries - fire element
  "â™‰": "Misc/Heart.png",      // Taurus - heart represents earth
  "â™Š": "Misc/Question Mark.png", // Gemini - duality/question
  "â™‹": "Misc/Heart.png",      // Cancer
  "â™Œ": "Misc/Fire.png",       // Leo - lion and fire
  "â™": "Misc/Virtous.png",    // Virgo - virtuous symbol
  "â™Ž": "Misc/Balance.png",    // Libra - doesn't exist yet, using balance concept
  "â™": "Emotes/Scorpion.png", // Scorpio - doesn't exist, using scared as proxy
  "â™": "Misc/Heart.png",       // Sagittarius - heart
  "â™‘": "Misc/Virtous.png",    // Capricorn - serious/virtuous
  "â™’": "Misc/Water.png",      // Aquarius 
  "â™“": "Misc/Fish.png",       // Pisces - doesn't exist, using water
  
  // Common unicode symbols
  "â—": "Misc/Exclamation Marks.png",
  "â•": "Misc/Exclamation Marks.png",
  "â€¼ï¸": "Misc/Exclamation Marks.png",
  "â‰ï¸": "Misc/Interrobang.png",
  "â“": "Misc/Question Mark.png", 
  "â”": "Misc/Question Mark.png",
  "âš¡": "Misc/Fire.png",        // lightning - fire
  "âœ¨": "Misc/Fire.png",        // sparkles - fire
  "â­": "Misc/Fire.png",        // star
  "ðŸŒŸ": "Misc/Fire.png",        // glowing star
  "ðŸ’«": "Emotes/Dizzy.png",     // dizzy - doesn't exist
  "ðŸ”´": "Misc/Circle.png",
  "ðŸŸ ": "Misc/Circle.png",
  "ðŸŸ¡": "Misc/Circle.png",
  "ðŸŸ¢": "Misc/Circle.png",
  "ðŸ”µ": "Misc/Circle.png",
  "ðŸŸ£": "Misc/Circle.png", 
  "âš«": "Misc/Circle.png",
  "âšª": "Misc/Circle.png",
  "ðŸŸ¤": "Misc/Circle.png",
  "âŒ": "Misc/X Mark.png",
  "âœ”ï¸": "Misc/Check Mark.png", 
  "âœ…": "Misc/Check Mark.png",
  "âŽ": "Misc/X Mark.png",
  "ðŸš«": "Misc/Stop.png",
  "â­•": "Misc/Circle.png",
  
  // People and gender
  "ðŸ‘": "Misc/Thumbs Up.png",
  "ðŸ‘Ž": "Misc/Thumbs Down.png",
  "ðŸ‘¦": "Misc/Male.png",
  "ðŸ‘§": "Misc/Female.png", 
  "ðŸ‘¨": "Misc/Male.png",
  "ðŸ‘©": "Misc/Female.png",
  "ðŸ‘´": "Misc/Male.png",
  "ðŸ‘µ": "Misc/Female.png",
  "ðŸ‘¶": "Misc/Genderless.png",
  "ðŸ‘¥": "Misc/Male.png",  // bust silhouette - assume male for simple
  
  // Animals
  "ðŸ»": "Misc/Bear.png",
  "ðŸ±": "Misc/Cat.png", 
  "ðŸˆ": "Misc/Cat.png",
  "ðŸ•": "Misc/Dog.png",
  "ðŸ¶": "Misc/Dog.png",
  "ðŸ‘»": "Misc/Ghost.png",
  
  // Time and clocks
  "ðŸ•": "Misc/Clock.png",
  "ðŸ•‘": "Misc/Clock.png",
  "ðŸ•’": "Misc/Clock.png", 
  "ðŸ•“": "Misc/Clock.png",
  "ðŸ•”": "Misc/Clock.png",
  "ðŸ••": "Misc/Clock.png",
  "ðŸ•–": "Misc/Clock.png",
  "ðŸ•—": "Misc/Clock.png",
  "ðŸ•˜": "Misc/Clock.png",
  "ðŸ•™": "Misc/Clock.png",
  "ðŸ•š": "Misc/Clock.png",
  "ðŸ•›": "Misc/Clock.png",
  "ðŸ•œ": "Misc/Clock.png",
  "ðŸ•": "Misc/Clock.png",
  "ðŸ•ž": "Misc/Clock.png",
  "ðŸ•Ÿ": "Misc/Clock.png",
  "ðŸ• ": "Misc/Clock.png",
  "ðŸ•¡": "Misc/Clock.png",
  "ðŸ•¢": "Misc/Clock.png",
  "ðŸ•£": "Misc/Clock.png",
  "ðŸ•¤": "Misc/Clock.png",
  "ðŸ•¥": "Misc/Clock.png",
  "ðŸ•¦": "Misc/Clock.png",
  "ðŸ•§": "Misc/Clock.png",
  "â°": "Misc/Clock.png",
  "â±ï¸": "Misc/Clock.png",
  "âŒš": "Misc/Clock.png",
  
  // Bomb related
  "ðŸ’£": "Misc/Bomb.png",
  "ðŸ’¥": "Misc/Bomb.png",      // collision symbol
  "ðŸ§¨": "Misc/Bomb.png",      // firecracker
  "ðŸ’¨": "Emotes/Oof.png",     // dash away
  
  // Audio
  "ðŸ”‡": "Misc/Mute.png",
  "ðŸ”ˆ": "Misc/Sound.png",
  "ðŸ”‰": "Misc/Sound.png", 
  "ðŸ”Š": "Misc/Sound.png",
  
  // Pile of poo
  "ðŸ’©": "Misc/Poo Poo.png"
};

export const unicodeEmojis = Object.keys(unicodeToPixelEmoji);

/**
 * Process text and replace Unicode emojis with pixel emoji images
 */
export function processUnicodeEmojis(text, basePath = "/Pixel Emoji Pack/") {
  let processed = text;

  // Build encoded URLs so spaces (e.g. "Pixel Emoji Pack") resolve correctly
  const buildPixelURL = (bp, filePath) => {
    const encodedFile = filePath.split("/").map(encodeURIComponent).join("/");

    if (/^https?:\/\//i.test(bp)) {
      try {
        const u = new URL(bp);
        const path = u.pathname.endsWith("/") ? u.pathname : (u.pathname + "/");
        return u.origin + path + encodedFile;
      } catch {
      }
    }

    const trimmed = bp.endsWith("/") ? bp.slice(0, -1) : bp;
    return `${trimmed}/${encodedFile}`;
  };

  // Replace only in text nodes (outside HTML tags) to avoid breaking attributes
  const parts = processed.split(/(<[^>]+>|<[^>]+>)/g);
  const replaceSegment = (segment) => {
    let out = segment;
    for (const emoji of unicodeEmojis) {
      const filePath = unicodeToPixelEmoji[emoji];
      if (!filePath) continue;
      const src = buildPixelURL(basePath, filePath);
      const imgTag = `<img src="${src}" alt="${emoji}" style="width: 20px; height: 20px; vertical-align: middle">`;
      const regex = new RegExp(escapeRegExp(emoji), "gu");
      out = out.replace(regex, imgTag);
    }
    return out;
  };
  processed = parts.map((p, i) => (i % 2 === 1 ? p : replaceSegment(p))).join("");

  return processed;
}

/**
 * Check if text contains any Unicode emojis we can replace
 */
export function containsUnicodeEmojis(text) {
  for (const emoji of unicodeEmojis) {
    const regex = new RegExp(escapeRegExp(emoji), 'gu');
    if (regex.test(text)) {
      return true;
    }
  }
  return false;
}

/**
 * Escape special characters for regex
 */
function escapeRegExp(string) {
  return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}